# 2장 객체 생성과 파괴
> 객체를 만들어야 할 떄와 만들지 말아야 할 때를 구분하는법,
올바른 객체 생성 방법과 불필요한 생성을 피하는 방법,
제때 파괴됨을 보장하고 파괴 전에 수행해야 할 정리 작업을 관리하는 요령 알아보기

---

## item2. 생성자에 매개변수가 많다면 빌더를 고려하라

식품 포장의 영양 정보를 표현하는 클래스를 생각해 봤을때,
식품의 양, 개수, 칼로리 같은 필수 항목 몇 개와 총 지방, 트랜스지방, 포화지방, 콜레스트롤, 나트륨 등 총 20개가 넘는 선택 항목으로 이루어진다.
대부분의 식품은 선택 필드 중 몇 개만 값을 가진다고 할 때 성상자를 어떻게 만들것인가.

### 1.점층적 생성자 패턴(telescoping constructor pattern)
> 필수 매개변수들만 갖는 생성자
필수 매개변수들 + 1개의 선택 매개변수를 갖는 생성자
필수 매개변수들 + 2개의 선택 매개변수를 갖는 생성자
...

위와 같은 형태로 모든 선택 매개변수를 생성자가 가질 수 있도록 여러개의 생성자를 겹겹이 만드는 방식.

![](https://images.velog.io/images/shkim1199/post/c245277a-1d6d-4fdf-87f4-4ce2cb96bf65/image.png)
> 오버로딩을 이용한 방식 이라고 할 수 있으며, 보통 원하지 않는 매개변수에도 초기값을 줘야한다.


![](https://images.velog.io/images/shkim1199/post/54769a52-4546-4843-b0e5-24b4641ad4ee/image.png)

**`단점:`**
매개변수 개수가 많아지면 클라이언트 코드를 작성하거나 읽기 어렵다.
(코드를 읽을 때 각 값의 의미가 무엇인지 헷갈리고, 매개변수가 몇 개인지도 주의해서 세어 보아야 함)


### 2.자바빈즈 패턴(JavaBeans pattern)
![](https://images.velog.io/images/shkim1199/post/a77cd3a4-1459-49b0-b57c-46d1e7862889/image.png)
![](https://images.velog.io/images/shkim1199/post/f0e4ea95-03b4-489a-9d0a-739db231d1be/image.png)

위와 같이 매개변수가 없는 생성자로 객체를 만든 후, 세터(setter) 메서드들을 호출해 원하는 매개변수의 값을 설정하는 방식.

코드가 길어졌지만 인스턴스를 만들기 쉽고, 그 결과 더 읽기 쉬운 코드가 되었음.

>`[getter, setter]:` 객체의 캡슐화와 정보은닉을 위해 인스턴스 변수는 private 으로 지정하고, 각 인스턴스 변수의 값은 public 메소드를 통해 다른 객체가 읽거나 변경하도록 한다. 이 때 값을 읽어주는 메소드를 getter, 값을 변경하는 메소드를 setter 라고 함,

**`단점:`**
자바빈즈 패턴에서는 객체 하나를 만들려면 메서드를 여러 개 호출해야 하고, 객체가 완전히 생성되기 전까지는 일관성이 무너진 상태에 놓인다.

이러한 문제 때문에 자바빈즈 패턴에서는 클래스를 불면으로 만들 수 없으며 thread 에서 안정성을 유지하려면 프로그래머의 추가적인 노력이 필효하다.

객체의 필드값들이 언제 어떻게 바뀌어 있을지 보장할 수 없다.



### 3. 빌더 패턴(Builder pattern)
점층적 생성자 패턴의 안전성 그리고 자바빈즈 패턴의 가독성을 결합한 방법



![](https://images.velog.io/images/shkim1199/post/74a78f93-cce9-4b47-a000-eb75278482d3/image.png)
![](https://images.velog.io/images/shkim1199/post/0372aaaa-2a8e-4807-b3d4-6f1424133ff9/image.png)
클라이언트는 필요한 객체를 직접 만드는 대신, 필수 매개변수만으로 생성자(혹은 정적 팩터리)를 호출해 빌더 객체를 얻음. 

그 다음에 빌더 객체가 제공하는 일종의 세터 메서드들로 원하는 선택 매개변수들을 설정한다.

마지막으로 매개변수가 없는 build 메서드를 호출해 드디어 우리에게 필요한(보통 불변) 객체를 얻는다.


**`장점:`**
* 작성이 쉽고 가독성이 좋다
![](https://images.velog.io/images/shkim1199/post/b5ac9a76-e3f0-4c56-8f41-1abee10b15bb/image.png)
* 빌더에 매개변수의 불변 규칙을 적용할 수 있고, build 메소드는 그런 불변 규칙을 검사할 수 있다.

>**`불변규칙:`**
매개변수나 필드가 가질 수 있는 값의 약속된 범위나 타입 및 형태

**`단점:`**
*  객체를 만들려면, 그에 앞서 빌더 부터 만들어야 한다. 빌더 생성 비용이 크지는 않지만 성능이 중요한 상황에서는 문제가 될 수있다.

* 점층적 생성자 패턴보다는 코드가 길어서 적어도 매개변수가 4개 이상은 되어야 값어치를 함.

하지만 코드는 언제든 수정 될 수 있고 언제 매개변수가 추가 될지 모르기 때문에 매개변수가 적더라도 처음부터 빌더로 시작하는 편이 좋을 수 있음.



---

# 핵심정리
  >**생성자나 정적 팩터리가 처리해야 할 매개변수가 많다면 빌더 패턴을 선택하는 게 더 낫다. 매개변수 중 다수가 필수가 아니거나 같은 타입이면 특히 더 그렇다. 빌더는 점층적 생성자보다 클라이언트 코드를 읽고 쓰기가 훨씬 간결하고, 자바빈즈보다 훨씬 안전하다**

  ---
# 출처

[이펙티브 자바 Effective Java 3/E](http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&ejkGb=KOR&barcode=9788966262281)
